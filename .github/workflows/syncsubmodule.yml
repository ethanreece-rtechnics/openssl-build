name: Update submodule
on:
  schedule: [cron: 0 10 * * *]
  workflow_dispatch:
jobs:
  update-submodules:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        submodules: true
        fetch-depth: 0
        token: ${{secrets.PUSH_TOKEN}}
    - uses: fregante/setup-git-user@v2
    - name: Update submodules
      run: |
        cd openssl
        currenttag=$(git describe --tags)
        latesttag=$(git tag | grep ^openssl-[0-9]\d*\.[0-9]\d*\.[0-9]\d*$ | tail -n1)
        if [[ "$currenttag" != "$latesttag" ]]; then
          git checkout "$latesttag"
          cd ../
          git commit -a -m "Update builds to $latesttag"
          git show --raw
          git tag "$latesttag"
          git push
        fi
